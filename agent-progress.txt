Vex v1.2 - Object-Storage-First Search Engine
=============================================

PROJECT SUMMARY:
Open-source search engine (vector + full-text + hybrid) compatible with turbopuffer's
published API. Core language: Go. Object storage is the system of record.

IDENTIFIED TASKS: 112 tasks across all categories
- Infrastructure: 13 tasks (project setup, object store, API scaffolding, config, etc.)
- Functional: 71 tasks (write path, query path, indexing, caching, routing, etc.)
- API: 15 tasks (all endpoints matching turbopuffer's HTTP API surface)
- Testing: 13 tasks (unit, golden, simulation, fault injection, compat suite)

RECOMMENDED APPROACH:
1. Phase 0: Go module, object store abstraction, API scaffolding
2. Phase 1: WAL + strong reads (namespace state, write API, tail, query)
3. Phase 2: Warm routing + cache (rendezvous hashing, NVMe/RAM cache)
4. Phase 3: ANN indexing (IVF centroid index, indexer process)
5. Phase 4: Filter indexes (roaring bitmaps, recall-aware filtering)
6. Phase 5: Full-text + hybrid (BM25, multi-query)
7. Phase 6: Polish (aggregations, namespace ops, schema rebuilds)

FIRST TASK: project-setup
Working agent should start with init.sh to scaffold Go project structure.

KEY DEPENDENCIES:
- Object storage (S3-compatible, MinIO for local dev)
- Go 1.21+ recommended for modern features
- Protobuf for WAL encoding, zstd for compression
- Roaring bitmaps for filter indexes
[2025-12-27T16:14:19.690Z] Completed project-setup: Set up Go project with a sensible stack, dependencies, and basic structure
[2025-12-27T16:24:03.250Z] Completed api-scaffolding: Create HTTP API scaffolding with router, auth middleware, and compression support
[2025-12-27T16:24:34.216Z] Completed single-binary-subcommands: Implement single binary with subcommands (query, indexer, all-in-one)
[2025-12-27T16:32:09.737Z] Completed document-id-validation: Validate document IDs (u64, UUID, or strings up to 64 bytes)
[2025-12-27T16:33:32.765Z] Completed namespace-name-validation: Validate namespace names match pattern [A-Za-z0-9-_.]{1,128}
[2025-12-27T16:38:15.824Z] Completed routing-rendezvous-hashing: Implement rendezvous hashing for cache-locality routing
[2025-12-27T16:45:00.064Z] Completed http-status-codes: Implement all required HTTP status codes
[2025-12-27T16:47:14.376Z] Completed routing-proxy: Implement request proxy to home node with fallback
[2025-12-27T17:09:25.992Z] Completed config-management: Implement configuration management
[2025-12-27T17:24:18.367Z] Completed error-response-format: Implement error response format for all endpoints
[2025-12-27T17:24:47.695Z] Completed attribute-name-validation: Validate attribute names (up to 128 chars, no $ prefix)
[2025-12-27T17:31:14.035Z] Completed membership-static: Implement static cluster membership from config
[2025-12-27T17:35:06.395Z] Completed failure-node-churn: Handle node churn and routing changes
[2025-12-27T17:36:39.261Z] Completed object-store-abstraction: Implement ObjectStore interface with S3-compatible and filesystem backends
[2025-12-27T17:45:06.686Z] Completed logging-structured: Implement structured JSON logging
[2025-12-27T17:45:53.546Z] Completed namespace-state-management: Implement namespace state.json management with ETag-based CAS
[2025-12-27T17:51:26.319Z] Completed wal-entry-format: Implement WAL entry format with protobuf encoding and zstd compression
[2025-12-27T17:57:12.675Z] Completed nvme-cache: Implement NVMe SSD cache for index objects
[2025-12-27T17:58:45.209Z] Completed schema-type-system: Implement schema type system with all supported types
[2025-12-27T18:04:24.889Z] Completed write-api-basic: Implement basic write endpoint POST /v2/namespaces/:namespace
[2025-12-27T18:09:09.572Z] Completed ram-cache: Implement RAM cache for hot index structures
[2025-12-27T18:11:31.714Z] Completed wal-commit-protocol: Implement WAL commit protocol with object storage durability
[2025-12-27T18:15:07.166Z] Completed vector-config: Implement vector configuration with dimensions, dtype, and distance metric
[2025-12-27T19:37:37.127Z] Completed write-upsert-rows: Implement upsert_rows with row-oriented document format
[2025-12-27T19:47:56.333Z] Completed filter-evaluation: Implement filter AST parsing and evaluation
[2025-12-27T19:53:37.063Z] Completed filter-eq-noteq: Implement Eq and NotEq filter operators
[2025-12-27T22:29:26.259Z] Completed write-upsert-columns: Implement upsert_columns with column-oriented document format
[2025-12-27T22:37:51.508Z] Completed schema-field-options: Implement schema field options (filterable, regex, full_text_search, vector)
[2025-12-27T22:38:59.341Z] Completed write-patch-rows: Implement patch_rows for partial document updates
[2025-12-27T22:46:08.925Z] Completed write-patch-columns: Implement patch_columns for columnar partial updates
[2025-12-27T22:49:24.869Z] Completed tail-materialization: Implement tail materialization for unindexed WAL overlay
[2025-12-27T22:54:03.092Z] Completed write-deletes: Implement deletes for removing documents by ID
[2025-12-27T23:05:12.000Z] Completed write-delete-by-filter: Re-verified delete_by_filter implementation
- Reviewed staged changes in `internal/write/handler.go`, `pkg/api/router.go`, `internal/write/delete_by_filter_test.go`.
- Verified delete_by_filter ordering, allow_partial handling, and rows_remaining response wiring.
- Checked two-phase re-evaluation logic against spec.
- Issue found: API treated invalid filter/limit-exceeded errors as 500.
- Resolved by mapping `ErrInvalidFilter` and `ErrDeleteByFilterTooMany` to 400.
- Confirmed no other regressions introduced by the fixes.
- Tests not re-run (per instruction to trust existing runs).
- Marked task as passing in `task_list.json`.
[2025-12-28T00:00:21.904Z] Completed write-patch-by-filter: Review patch_by_filter two-phase implementation
- Reviewed changes in `internal/write/handler.go`, `internal/write/patch_by_filter_test.go`, `pkg/api/router.go`.
- Verified patch_by_filter two-phase logic, ordering after delete_by_filter, and rows_remaining handling.
- Verified API maps patch_by_filter limit and vector patch errors to 400.
- Issue found: patch_by_filter updates skipped attribute name validation and allowed updating `id`.
- Resolved by validating update keys and ignoring `id` before canonicalization.
- Tests not re-run (per instruction to trust existing runs).
- Marked task as passing in `task_list.json`.
[2025-12-28T00:10:56.741Z] Completed write-copy-from-namespace: Review server-side bulk copy implementation
- Reviewed staged changes in `internal/write/handler.go` and new tests in `internal/write/copy_from_namespace_test.go`.
- Verified write ordering includes copy_from_namespace after patch_by_filter and before explicit upserts/patches/deletes.
- Verified source namespace snapshot read via tail refresh to WAL head and bulk upsert into WAL sub-batch.
- Verified parse support for copy_from_namespace in write request handling.
- Checked error handling for missing source namespace and missing tail store.
- No correctness issues found in the implementation.
- Tests not re-run (per instruction to trust prior runs).
- Marked task as passing in `task_list.json`.
[2025-12-28T00:25:31.132Z] Completed write-schema-updates: Review explicit schema updates in write requests
- Reviewed staged changes in `internal/write/handler.go`, `internal/namespace/manager.go`, `pkg/api/router.go`, `internal/write/handler_test.go`, `pkg/api/write_test.go`.
- Verified schema object parsing, validation, and WAL/state update wiring for explicit schema changes.
- Verified atomic schema/WAL updates and 400 mapping for invalid schema and type change.
- Issue found: regex updates to false (and full_text_search disable) could not be applied due to merge logic.
- Resolved by carrying forward existing attribute values during validation and replacing attributes during schema delta apply.
- Ensured type immutability enforcement remains intact for existing attributes.
- Tests not re-run (per instruction to trust existing runs).
- Marked task as passing in `task_list.json`.
[2025-12-28T00:34:12.321Z] Completed write-conditional-upsert: Review conditional upsert implementation
- Reviewed staged changes in `internal/write/handler.go`, `internal/filter/ref_new.go`, and new tests in `internal/write/conditional_upsert_test.go` and `internal/filter/ref_new_test.go`.
- Verified upsert_condition parsing and conditional evaluation against existing docs with tail refresh at WAL head.
- Verified missing doc applies unconditionally, existing doc applies only when condition matches, and $ref_new values resolve from new row attributes.
- Issue found: invalid upsert_condition filters were silently skipped; updated to return ErrInvalidFilter on parse errors.
- No other correctness issues found in conditional upsert flow.
- Tests not re-run (per instruction to trust existing runs).
- Marked task as passing in `task_list.json`.
